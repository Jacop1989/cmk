# cmk — C Minimal Kernel (แกน CAD เขียนด้วย C ล้วน)

CMK คือแกน (kernel) สำหรับงาน CAD ที่มุ่งเน้นความเรียบง่าย ขนาดเล็ก และพกพาสูง เขียนด้วยภาษา C ล้วน (C11) โดยไม่พึ่งพาไลบรารีภายนอก เหมาะสำหรับใช้เป็นฐานทดลองด้านเรขาคณิต/ทอพอโลยี 3D, การสร้างตาข่าย (mesh), และงานวิศวกรรมที่ต้องการควบคุมหน่วยความจำและสมรรถนะอย่างคาดเดาได้

โปรเจกต์นี้เริ่มต้นด้วยรูปแบบซิงเกิลไฟล์ `cmk_single.c` เพื่อให้คอมไพล์และทดลองได้รวดเร็ว จากนั้นค่อยพัฒนาไปสู่โครงสร้างที่แยกโมดูลได้ในอนาคต

## ภาพรวม (Overview)
- ภาษา: C (C11), พกพาสูง คอมไพล์ได้ด้วย GCC/Clang/MSVC
- ไม่มี dependency ภายนอก (zero deps)
- เน้นความถูกต้อง-ก่อน (correctness-first) และโค้ดที่อ่านง่าย/ตรวจสอบง่าย
- โฟกัสงาน CAD พื้นฐาน: เรขาคณิต 3D, โครงสร้างตาข่าย, และการส่งออกไฟล์รูปแบบง่ายๆ
- สถานะปัจจุบัน: เวอร์ชันเริ่มต้น v0.1 พร้อมเดโมสร้างโมเดลง่ายๆ และเขียนไฟล์ STL แบบไบนารี

## คุณสมบัติ v0.1
- โครงสร้างแบบไฟล์เดียว: `cmk_single.c` พร้อม `main()` สำหรับเดโม
- ชนิดข้อมูลและคณิตศาสตร์พื้นฐาน:
  - เวกเตอร์ `vec3` และเมทริกซ์ 4x4 (`mat4`) พร้อมฟังก์ชันพื้นฐาน (บวก/ลบ/คูณ, cross/dot, normalize, แปลงด้วยเมทริกซ์)
- โครงสร้างข้อมูลตาข่าย (Mesh):
  - เก็บจุดยอด (vertices) และดัชนีสามเหลี่ยม (triangle index list)
  - ยูทิลิตี้แปลง (transform) และรวมตาข่าย (merge)
- พรีมิติฟพื้นฐาน:
  - กล่อง (box) และทรงกระบอก (cylinder) พร้อมพารามิเตอร์ขนาด/จำนวนด้าน
- ตัวเขียนไฟล์ STL แบบไบนารี:
  - ฟังก์ชัน `mesh_write_stl_binary(path, mesh)` สร้างไฟล์ STL มาตรฐาน
- เดโม (smoke test):
  - สร้างแผ่นสี่เหลี่ยมและ “รู” แบบทรงกระบอก (ยังไม่ตัดจริง) แล้วส่งออก `plate_only.stl` และ `holes_only.stl`
  - ยังไม่มี boolean (union/diff/intersect) — จะมาในระยะถัดไป

## Roadmap (v0.1 → v0.4)
- v0.1 (Bootstrap)
  - โครงสร้างข้อมูลพื้นฐาน, คณิตศาสตร์ 3D เบื้องต้น, พรีมิติฟ box/cylinder, เขียน STL, เดโมสร้างไฟล์
- v0.2 (Geometry Ops)
  - เตรียมสู่ boolean เบื้องต้นสำหรับโมเดลเรียบง่าย (เช่น ตัดรูจากแผ่น)
  - ปรับปรุงความถูกต้องด้านปกติผิว/ทิศทางสามเหลี่ยม และยูทิลิตี้ AABB
  - จัดรูป API สำหรับ mesh ให้ชัดเจนขึ้น
- v0.3 (Mesh/IO & 3D Foundations)
  - เพิ่ม I/O เบื้องต้น (เช่น อ่าน/เขียน STL/OBJ แบบย่อ)
  - โครงร่างโทโพโลยีที่เข้มแข็งขึ้นสำหรับการแก้ไขเมช
  - ยูทิลิตี้โครงสร้างพื้นที่ (เช่น BVH/AABB tree) เพื่อเร่งความเร็วการคำนวณ
- v0.4 (Robustness & Performance)
  - ปรับความเสถียรเชิงตัวเลขและความแม่นยำของปฏิบัติการเรขาคณิต
  - โปรไฟล์และปรับปรุงสมรรถนะ, รองรับงานขนานในจุดที่เหมาะสม
  - เอกสารและโครงสร้างโค้ดแยกโมดูล (แยกไฟล์) พร้อมตัวอย่างเพิ่มเติม

## วิธี Build
ต้องมีคอมไพเลอร์ C ที่รองรับ C11 และบน Linux/macOS ต้องลิงก์กับ `libm` (`-lm`). ไฟล์หลักคือ `cmk_single.c` ซึ่งมี `main()` สำหรับเดโมสร้างไฟล์ STL ตัวอย่าง

- Linux/macOS (GCC/Clang):

  ```bash
  gcc -O2 -std=c11 cmk_single.c -o cmk_demo -lm
  ./cmk_demo
  # จะได้ไฟล์: plate_only.stl, holes_only.stl
  ```

- Windows (MSVC Developer Command Prompt):

  ```bat
  cl /O2 /nologo /D_USE_MATH_DEFINES cmk_single.c /Fe:cmk_demo.exe
  cmk_demo.exe
  REM จะได้ไฟล์: plate_only.stl, holes_only.stl
  ```

  หมายเหตุ: กำหนด `/_D_USE_MATH_DEFINES` เพื่อใช้ค่าคงที่ `M_PI` จาก `math.h` บน MSVC

- Windows (MinGW/MSYS2 GCC):

  ```bash
  gcc -O2 -std=c11 cmk_single.c -o cmk_demo.exe -lm
  ./cmk_demo.exe
  ```

โครงสร้างซอร์สขณะนี้เป็นไฟล์เดียวเพื่อความสะดวกในการเริ่มต้น ในอนาคตอาจแยกเป็นเฮดเดอร์/ซอร์สหลายไฟล์พร้อม CMake/Makefile

## License
โปรเจกต์นี้ใช้สัญญาอนุญาต MIT — ดูรายละเอียดที่ไฟล์ `LICENSE` ในรากของโปรเจกต์

---
หากต้องการฟีเจอร์/ตัวอย่างเพิ่มเติม หรือพบปัญหาในการคอมไพล์/รัน โปรดเปิดประเด็น (issue) หรือแจ้งรายละเอียดสภาพแวดล้อมและคำสั่งที่ใช้ เพื่อช่วยวิเคราะห์ให้ตรงจุด
